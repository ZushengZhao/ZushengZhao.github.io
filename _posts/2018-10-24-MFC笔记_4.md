---
layout: post
title: "MFC笔记_4"
date: 2018-10-24
categories: MFC
tags: [MFC, Visual Studio]
description: 用CStdioFile读文件和写文件。
---

摘要：实际需要使用从一个文件中读取一些列点的坐标数据给机械臂运动。

---

## CStdioFile类的使用

1. 创建这个类的对象；

2. 调用open方法，打开某个文件（前两步可以合并）；

3. 如果有必要，就调用 SeekToEnd()，将文件指针移到文件末尾；

4. 调用WriteString() 写入文件，或者调用ReadString（）读取文件；

5. 写完之后关闭文件。

- 其中创建这个类的对象，我们用的是**CStdioFile类**，CStdioFile类是**CFile类**的子类。CStdioFile类继承于CFile类，扩展了文本文件的操作，认识回车换行字符，可以用**函数ReadString()、WriteString()进行一行字符串的读写**，相当于流式文件的操作。

### 代码分析

```python
void CDemoDlg::OnBnClickedOk()
{
	
	msg tmp;
	
	// TODO:  在此添加控件通知处理程序代码
    /// My Add 
    // 获取当前路径名
    WCHAR szPaht[MAX_PATH] = { 0 };
    GetModuleFileName(NULL, szPaht, sizeof(szPaht));
    PathRemoveFileSpec(szPaht);
    
    // 设置你的文件名
    CString strFileName("Demo.txt");

    // 将文件名附加在 当前路径 里面
    wcscat_s(szPaht, L"\\");  ///知道为啥是L 开头吗，因为vs2013工程默认是unicode环境，unicode字符串需要 L  开头的宏
    wcscat_s(szPaht, strFileName.GetString());

    /// 必须 设置 一下 语言环境，否则 my_log_file.WriteString 不能输出中文（是不是感觉好复杂？）没关系，当前工程能跑起来，能够就行。
    setlocale(LC_ALL, "chs");

    // 文件读写 StdioFile
    // 1.创建 CStdioFile的对象，并指定 读写文件的方式。 CFile::modeNoTruncate，不会覆盖之前的文件。

	CStdioFile my_log_file(szPaht, CFile::modeRead | CFile::modeCreate | CFile::modeNoTruncate);
    // 2.将读写指针移到文件末尾
	char buf[1024] = { 0 };
	CString sss;
	int i = 0;
	char *token1 = NULL;
	while (my_log_file.ReadString(sss))
	{
		MessageBox(sss);
		CStringA a;
		a = sss;
		char *pp = a.GetBuffer();

		
		CString aa;
		CString zz;
		char *sst = strtok_s(pp, "|",&token1);
		MessageBox(TEXT("113:%d",&sst));
			if (sst != NULL)
			{
				aa = CString(sst);
				MessageBox(aa);
				tmp.x[i] = atof(sst);
				zz.Format(_T("%f"), tmp.x[i]);
				MessageBox(zz);

				sst = strtok_s(NULL, "|", &token1);
				aa = CString(sst);
				MessageBox(aa);
				tmp.y[i] = atof(sst);

				sst = strtok_s(NULL, "|", &token1);
				aa = CString(sst);
				MessageBox(aa);
				tmp.z[i] = atof(sst);
				i = i + 1;

				/*CString xx;
				xx.Format(_T("x坐标是:%d\n"), tmp.x);
				MessageBox(xx);
				MessageBox(TEXT("111"));*/
			}
			else
			{
				break;
			}

		/*sst = strtok_s(NULL, "|", &sst);
		tmp.y = atof(sst);

		sst = strtok_s(NULL, "|", &sst);
		tmp.z = atof(sst);*/
	}
	CString ii;
	ii.Format(_T("%i"), i);
	MessageBox(ii);
	int j;
	CString jj;
	for (j = 0; j < i; j++)
	{
		
		jj.Format(_T("%f"), tmp.x[j]);
		MessageBox(jj);
		jj.Format(_T("%f"), tmp.y[j]);
		MessageBox(jj);
		jj.Format(_T("%f"), tmp.z[j]);
		MessageBox(jj);
	}
	my_log_file.Close();
}
```
