---
layout: post
title: "STM32F407学习笔记_3"
date: 2018-07-12
categories: STM32
tags: [STM32, 串口调试 ]
description: STM32F407学习笔记_3
---

摘要：用串口下载程序，然后通过串口调试助手进行程序的调试，调试过程出现printf()输出乱码情况的分析。

---
## STM32串口程序下载

### 程序下载

### STM32程序下载的标准方法：

1. B0接V3.3,B1接GND；
2. 按一下复位按键。

通过上述两步可以下载代码，代码执行需要把B0接回GND，然后再按一下复位键，比较繁琐。正点原子的开发板设置了一键下载电路。

### 一键下载代码

- 利用串口的DTR和RTS信号，配合上位机flymcu，设置DTR低电平复位，RTS高电平进BootLoader,实现一键下载。步骤如下：

1. 插入串口线，安装CH340驱动，驱动安装完成之后会在电脑的控制面板里面的**端口**下面看到**USB-SERIAL CH340(COM*)**,COM后面的数字不固定；
2. 打开flymcu软件，找到工程所在文件夹里**obj**子文件夹，加载里面的的hex文件，这个文件时工程编译之后生成的，设置软件的各个选项如图所示；
3. 装载完hex文件之后，自动搜索并选择串口，设置串口的波特率，这里设置的串口波特率，要跟代码里面初始化串口设置的波特率相同，不然用调试助手输出字符的时候会乱码，然后点击开始编程按钮；
4. 代码下载完成之后会自动运行，可以在flymcu软件窗口的右边看到代码下载和运行的一些数据，如下图。

### 串口调试助手使用

1. 打开串口调试助手**XCOM V2.0**，进行串口的选择和波特率设置；
2. 通过关闭和打开串口，进行串口调试的开关，在显示区域会显示代码中```printf()```函数打印的数据；
3. 通过发送窗口可以实现串口的接收功能。

## 一些小问题

### 波特率设置，printf出现乱码

- 在用串口助手调试的时候，由于波特率设置的问题，出现了几处错误，总结一下。

1. 串口助手XCOM的波特率选择与代码中初始化串口的波特率不一样，导致XCOM界面中printf的输出乱码；
2. 由于代码的中，```printf()```放置在了串口初始化函数```Uart1Init()```之前，导致printf输出乱码，这里要十分注意，是自己找了半天才发现的问题，也是对串口的功能认识不深刻所导致。
 
